{"version":3,"file":"utils.js","sources":["../../utils/src/utils.ts","../../utils/src/locator.ts"],"sourcesContent":["let __debug = false;\n\n/**\n * @public\n */\nexport interface AspectOptions {\n    id?: string;\n}\n/**\n * @public\n */\nexport type Mutable<T> = {\n    -readonly [K in keyof T]: T[K];\n};\nconst ASPECT_OPTIONS_REFLECT_KEY = 'aspectjs.aspect.options';\nconst ASPECT_ORIGINAL_CTOR_KEY = 'aspectjs.referenceConstructor';\n\n/**\n * @public\n */\nexport function _getReferenceConstructor(proto: object & { constructor: { new (...args: unknown[]): unknown } }) {\n    return Reflect.getOwnMetadata(ASPECT_ORIGINAL_CTOR_KEY, proto) ?? proto.constructor;\n}\n\n/**\n * @public\n */\nexport function _setReferenceConstructor<T>(proto: object, originalCtor: { new (...args: any[]): T }) {\n    assert(isFunction(originalCtor));\n    Reflect.defineMetadata(ASPECT_ORIGINAL_CTOR_KEY, originalCtor, proto);\n}\n\n/**\n * @public\n */\nexport function isAspect(aspect: object | Function) {\n    return !!__getAspectOptions(aspect);\n}\n\n/**\n * @public\n */\nexport function assertIsAspect(aspect: object | Function) {\n    if (!isAspect(aspect)) {\n        const proto = getProto(aspect);\n        throw new TypeError(`${proto.constructor.name} is not an Aspect`);\n    }\n}\n\nfunction __getAspectOptions(aspect: object | Function): AspectOptions {\n    if (!aspect) {\n        return;\n    }\n    const proto = getProto(aspect);\n    if (proto) {\n        return Reflect.getOwnMetadata(ASPECT_OPTIONS_REFLECT_KEY, proto);\n    }\n}\n/**\n * @public\n */\nexport function getAspectOptions(aspect: object | Function): AspectOptions {\n    assertIsAspect(aspect);\n    return __getAspectOptions(aspect);\n}\n\n/**\n * @public\n */\nexport function setAspectOptions(target: Function, options: AspectOptions): void {\n    Reflect.defineMetadata(ASPECT_OPTIONS_REFLECT_KEY, options, getProto(target));\n}\n\n/**\n * @internal\n */\nexport function __setDebug(debug: boolean) {\n    __debug = debug;\n}\n\n/**\n * @public\n */\nexport function assert(condition: boolean, errorProvider?: () => Error): void;\n\n/**\n * @public\n */\nexport function assert(condition: boolean, msg?: string): void;\n\n/**\n * @public\n */\nexport function assert(condition: boolean, msg?: string | (() => Error)) {\n    if (__debug && !condition) {\n        debugger;\n        const e = isFunction(msg) ? (msg as Function)() : new Error(msg ?? 'assertion error');\n        const stack = e.stack.split('\\n');\n        stack.splice(1, 1);\n        e.stack = stack.join('\\n');\n\n        throw e;\n    }\n}\n\n/**\n * @public\n */\nexport function getOrComputeMetadata<T>(key: string, target: object, valueGenerator: () => T, save?: boolean): T;\n\n/**\n * @public\n */\nexport function getOrComputeMetadata<T>(\n    key: string,\n    target: object,\n    propertyKey: string,\n    valueGenerator: () => T,\n    save?: boolean,\n): T;\nexport function getOrComputeMetadata<T>(\n    key: string,\n    target: object,\n    propertyKey: string | (() => T),\n    valueGenerator?: (() => T) | boolean,\n    save = true,\n): T {\n    let _propertyKey = propertyKey as string;\n    let _valueGenerator = valueGenerator as () => T;\n    if (typeof valueGenerator === 'boolean') {\n        save = valueGenerator;\n    }\n    if (typeof propertyKey === 'function') {\n        _valueGenerator = propertyKey;\n        _propertyKey = undefined;\n    }\n\n    assert(!!target);\n    let value = Reflect.getOwnMetadata(key, target, _propertyKey);\n    if (isUndefined(value)) {\n        value = _valueGenerator();\n        if (save) {\n            Reflect.defineMetadata(key, value, target, _propertyKey);\n        }\n    }\n\n    return value;\n}\n\n/**\n * @public\n */\nexport function getProto(\n    target: Record<string, any> | Function,\n): Record<string, any> & { constructor?: new (...args: any[]) => any } {\n    if (isFunction(target)) {\n        return target.prototype;\n    } else if (target === null || target === undefined) {\n        return target as any;\n    }\n    return target.hasOwnProperty('constructor') ? target : Object.getPrototypeOf(target);\n}\n\n/**\n * @public\n */\nexport function isObject(value: any): value is object {\n    return typeof value === 'object' && !isArray(value);\n}\n\n/**\n * @public\n */\nexport function isArray(value: any): value is any[] {\n    return !isUndefined(value) && value !== null && Object.getPrototypeOf(value) === Array.prototype;\n}\n\n/**\n * @public\n */\nexport function isString(value: any): value is string {\n    return typeof value === 'string';\n}\n\n/**\n * @public\n */\nexport function isUndefined(value: any): value is undefined {\n    return typeof value === 'undefined';\n}\n\n/**\n * @public\n */\nexport function isFunction(value: any): value is (...args: any[]) => any {\n    return typeof value === 'function';\n}\n\n/**\n * @public\n */\nexport function isNumber(value: any): value is number {\n    return typeof value === 'number';\n}\n\n/**\n * @public\n */\nexport function isEmpty(value: any): boolean {\n    return value.length === 0;\n}\n\n/**\n * @public\n */\nexport function isPromise(obj: any): obj is Promise<any> {\n    return isFunction(obj?.then);\n}\n","/**\n * Null-safe navigation through object properties, that allows to generate missing properties on the fly.\n *\n * @public\n */\nexport class Locator<U> {\n    constructor(private _obj: U, private _parent?: Locator<any>, private _parentKey?: string | number | symbol) {}\n\n    /**\n     * Descend to the given property of the object.\n     * @param propertyName - the property to access to.\n     */\n    at<K extends keyof U>(propertyName: K): Locator<U[K]> {\n        return new Locator(this._obj ? this._obj[propertyName] : undefined, this, propertyName);\n    }\n\n    /**\n     * Get the property value\n     * @returns the property value (can be null)\n     */\n    get(): U {\n        return this._obj;\n    }\n\n    /**\n     * Get the property value, or generate a new one with the given function.\n     * The generated property is then saved into the object.\n     * @param valueProvider - the function used to generate a new value\n     * @returns the property value\n     */\n    orElseCompute(valueProvider: () => U): U {\n        return this.orElse(valueProvider, true);\n    }\n\n    /**\n     * Get the property value, or generate a new one with the given function.\n     * The generated property is **not** saved into the object.\n     * @param valueProvider - the function used to generate a new value\n     * @returns the property value\n     */\n    orElseGet(valueProvider: () => U): U {\n        return this.orElse(valueProvider, false);\n    }\n\n    /**\n     * Get the property value, or generate a new one with the given function.\n     * @param valueProvider - the function used to generate a new value\n     * @param save - if the generated property should then be saved into the object.\n     * @returns the property value\n     */\n    orElse(valueProvider: () => U, save = true): U {\n        const value = this._obj ?? valueProvider();\n        if (save) {\n            this._obj = value;\n            this._parent._patch(value, this._parentKey);\n        }\n        return value;\n    }\n\n    private _patch<K extends keyof U>(value: U[K], key: K) {\n        if (!this._obj) {\n            this._obj = {} as U;\n            if (this._parent) {\n                this._parent._patch(this._obj, this._parentKey);\n            }\n        }\n        this._obj[key] = value;\n    }\n}\n\n/**\n * @param obj - the object to navigate through.\n *\n * @public\n */\nexport function locator<U = unknown>(obj: U) {\n    return new Locator(obj);\n}\n"],"names":[],"mappings":"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"}