!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports,require("@aspectjs/core/utils")):"function"==typeof define&&define.amd?define(["exports","@aspectjs/core/utils"],factory):factory(((global="undefined"!=typeof globalThis?globalThis:global||self).aspectjs=global.aspectjs||{},global.aspectjs.core_commons={}),global.aspectjs.core_utils)}(this,(function(exports,utils){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _construct(Parent,args,Class){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function(Parent,args,Class){var a=[null];a.push.apply(a,args);var instance=new(Function.bind.apply(Parent,a));return Class&&_setPrototypeOf(instance,Class.prototype),instance}).apply(null,arguments)}function _wrapNativeSuper(Class){var _cache="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(Class){if(null===Class||(fn=Class,-1===Function.toString.call(fn).indexOf("[native code]")))return Class;var fn;if("function"!=typeof Class)throw new TypeError("Super expression must either be null or a function");if(void 0!==_cache){if(_cache.has(Class))return _cache.get(Class);_cache.set(Class,Wrapper)}function Wrapper(){return _construct(Class,arguments,_getPrototypeOf(this).constructor)}return Wrapper.prototype=Object.create(Class.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(Wrapper,Class)})(Class)}function _possibleConstructorReturn(self,call){return!call||"object"!=typeof call&&"function"!=typeof call?function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||_unsupportedIterableToArray(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(iter))return Array.from(iter)}(arr)||_unsupportedIterableToArray(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _wrapRegExp(re,groups){_wrapRegExp=function(re,groups){return new BabelRegExp(re,void 0,groups)};var _RegExp=_wrapNativeSuper(RegExp),_super=RegExp.prototype,_groups=new WeakMap;function BabelRegExp(re,flags,groups){var _this=_RegExp.call(this,re,flags);return _groups.set(_this,groups||_groups.get(re)),_this}function buildGroups(result,re){var g=_groups.get(re);return Object.keys(g).reduce((function(groups,name){return groups[name]=result[g[name]],groups}),Object.create(null))}return _inherits(BabelRegExp,_RegExp),BabelRegExp.prototype.exec=function(str){var result=_super.exec.call(this,str);return result&&(result.groups=buildGroups(result,this)),result},BabelRegExp.prototype[Symbol.replace]=function(str,substitution){if("string"==typeof substitution){var groups=_groups.get(this);return _super[Symbol.replace].call(this,str,substitution.replace(/\$<([^>]+)>/g,(function(_,name){return"$"+groups[name]})))}if("function"==typeof substitution){var _this=this;return _super[Symbol.replace].call(this,str,(function(){var args=[];return args.push.apply(args,arguments),"object"!=typeof args[args.length-1]&&args.push(buildGroups(args,_this)),substitution.apply(this,args)}))}return _super[Symbol.replace].call(this,str,substitution)},_wrapRegExp.apply(this,arguments)}var AnnotationType;(AnnotationType=exports.AnnotationType||(exports.AnnotationType={})).CLASS="AnnotationType.CLASS",AnnotationType.PROPERTY="AnnotationType.PROPERTY",AnnotationType.METHOD="AnnotationType.METHOD",AnnotationType.PARAMETER="AnnotationType.PARAMETER";var _AnnotationPointcutEx,PointcutPhase,Pointcut,_POINTCUT_REGEXPS,POINTCUT_REGEXPS,AnnotationRef=function(){function AnnotationRef(groupIdOrRef,name){var _this=this;if(_classCallCheck(this,AnnotationRef),name)this.ref="".concat(groupIdOrRef,":").concat(name),this.name=name,this.groupId=groupIdOrRef;else{this.ref=groupIdOrRef;var macth=_wrapRegExp(/([\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uFEFE\uFF00-\uFFFF]+):([\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uFEFE\uFF00-\uFFFF]+)/,{groupId:1,name:2}).exec(this.ref);this.groupId=macth.groups.groupId,this.name=macth.groups.name}if(!this.name)throw utils.assert(!1),new Error("cannot create annotation without name");if(!this.groupId)throw new Error("cannot create annotation without groupId");Object.defineProperty(this,Symbol.toPrimitive,{enumerable:!1,value:function(){return"@".concat(_this.name)}})}return _createClass(AnnotationRef,[{key:"toString",value:function(){return"@".concat(this.groupId,":").concat(this.name)}}]),AnnotationRef}(),AspectError=function(_Error){_inherits(AspectError,_Error);var _super=_createSuper(AspectError);function AspectError(ctxt,message){return _classCallCheck(this,AspectError),_super.call(this,"Error applying advice ".concat(ctxt.advice," on ").concat(ctxt.target.label,": ").concat(message))}return AspectError}(_wrapNativeSuper(Error)),WeavingError=function(_Error){_inherits(WeavingError,_Error);var _super=_createSuper(WeavingError);function WeavingError(){return _classCallCheck(this,WeavingError),_super.apply(this,arguments)}return WeavingError}(_wrapNativeSuper(Error)),AdviceError=function(_WeavingError){_inherits(AdviceError,_WeavingError);var _super=_createSuper(AdviceError);function AdviceError(advice,message){return _classCallCheck(this,AdviceError),_super.call(this,"".concat(advice,": ").concat(message))}return AdviceError}(WeavingError),PointcutExpression=function(){function PointcutExpression(_label){var _annotations=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];_classCallCheck(this,PointcutExpression),this._label=_label,this._annotations=_annotations,this._name="*",this._expr=_trimSpaces("".concat(this._label," ").concat(this._annotations.map((function(a){return"@".concat(a.ref)})).join(",")," ").concat(this._name))}return _createClass(PointcutExpression,[{key:"toString",value:function(){return this._expr}}],[{key:"of",value:function(type,annotation){return AnnotationPointcutExpressionBuilders[type].withAnnotations(annotation)}}]),PointcutExpression}(),AnnotationPointcutExpressionBuilder=function(){function AnnotationPointcutExpressionBuilder(_label){_classCallCheck(this,AnnotationPointcutExpressionBuilder),this._label=_label}return _createClass(AnnotationPointcutExpressionBuilder,[{key:"withAnnotations",value:function(){for(var _len=arguments.length,annotation=new Array(_len),_key=0;_key<_len;_key++)annotation[_key]=arguments[_key];return new PointcutExpression(this._label,annotation)}}]),AnnotationPointcutExpressionBuilder}(),PropertyAnnotationPointcutExpressionBuilder=function(){function PropertyAnnotationPointcutExpressionBuilder(){_classCallCheck(this,PropertyAnnotationPointcutExpressionBuilder),this.setter=new AnnotationPointcutExpressionBuilder("property#set")}return _createClass(PropertyAnnotationPointcutExpressionBuilder,[{key:"withAnnotations",value:function(){for(var _len2=arguments.length,annotation=new Array(_len2),_key2=0;_key2<_len2;_key2++)annotation[_key2]=arguments[_key2];return new PointcutExpression("property#get",annotation)}}]),PropertyAnnotationPointcutExpressionBuilder}(),AnnotationPointcutExpressionBuilders=(_defineProperty(_AnnotationPointcutEx={},exports.AnnotationType.CLASS,new AnnotationPointcutExpressionBuilder("class")),_defineProperty(_AnnotationPointcutEx,exports.AnnotationType.METHOD,new AnnotationPointcutExpressionBuilder("method")),_defineProperty(_AnnotationPointcutEx,exports.AnnotationType.PARAMETER,new AnnotationPointcutExpressionBuilder("parameter")),_defineProperty(_AnnotationPointcutEx,exports.AnnotationType.PROPERTY,new PropertyAnnotationPointcutExpressionBuilder),_AnnotationPointcutEx),on={class:AnnotationPointcutExpressionBuilders[exports.AnnotationType.CLASS],method:AnnotationPointcutExpressionBuilders[exports.AnnotationType.METHOD],parameter:AnnotationPointcutExpressionBuilders[exports.AnnotationType.PARAMETER],property:AnnotationPointcutExpressionBuilders[exports.AnnotationType.PROPERTY]};function _trimSpaces(s){return s.replace(/\s+/," ")}(PointcutPhase=exports.PointcutPhase||(exports.PointcutPhase={})).COMPILE="Compile",PointcutPhase.AROUND="Around",PointcutPhase.BEFORE="Before",PointcutPhase.AFTERRETURN="AfterReturn",PointcutPhase.AFTER="After",PointcutPhase.AFTERTHROW="AfterThrow",Pointcut=exports.Pointcut||(exports.Pointcut={}),_defineProperty(_POINTCUT_REGEXPS={},exports.AnnotationType.CLASS,new RegExp("class(?:\\s+\\@(?<annotation>\\S+?:\\S+))?(?:\\s+(?<name>\\S+?))\\s*")),_defineProperty(_POINTCUT_REGEXPS,exports.AnnotationType.PROPERTY,new RegExp("property#(?:get|set)(?:\\s+\\@(?<annotation>\\S+?:\\S+))?(?:\\s+(?<name>\\S+?))\\s*")),_defineProperty(_POINTCUT_REGEXPS,exports.AnnotationType.METHOD,new RegExp("method(?:\\s+\\@(?<annotation>\\S+?:\\S+))?(?:\\s+(?<name>\\S+?))\\s*")),_defineProperty(_POINTCUT_REGEXPS,exports.AnnotationType.PARAMETER,new RegExp("parameter(?:\\s+\\@(?<annotation>\\S+?:\\S+))?(?:\\s+(?<name>\\S+?))\\s*")),POINTCUT_REGEXPS=_POINTCUT_REGEXPS,Pointcut.of=function(phase,exp){for(var pointcut,ref=exp.toString(),_i=0,_Object$entries=Object.entries(POINTCUT_REGEXPS);_i<_Object$entries.length;_i++){var _entry=_slicedToArray(_Object$entries[_i],2),type=_entry[0],match=_entry[1].exec(ref);if(null==match?void 0:match.groups.name)return utils.assert(!!match.groups.annotation,"only annotation pointcuts are supported"),pointcut={type:type,phase:phase,annotation:new AnnotationRef(match.groups.annotation),name:match.groups.name,ref:ref},Reflect.defineProperty(pointcut,Symbol.toPrimitive,{value:function(){return"".concat(phase,"(").concat(ref,")")}}),pointcut}throw new WeavingError("expression ".concat(ref," not recognized as valid pointcut expression"))};var _weaverContext,_JoinpointFactory=function(){function _JoinpointFactory(){_classCallCheck(this,_JoinpointFactory)}return _createClass(_JoinpointFactory,null,[{key:"create",value:function(advice,ctxt,fn){function alreadyCalledFn(){throw new AdviceError(advice,"joinPoint already proceeded")}return function(args){if(args=null!=args?args:ctxt.args,!utils.isArray(args))throw new AdviceError(advice,"Joinpoint arguments expected to be array. Got: ".concat(args));var jp=fn;return fn=alreadyCalledFn,jp.apply(ctxt.instance,args)}}}]),_JoinpointFactory}(),WeaverProfile=function(){function WeaverProfile(){_classCallCheck(this,WeaverProfile),this._aspectsRegistry={}}return _createClass(WeaverProfile,[{key:"enable",value:function(){for(var _this=this,_len=arguments.length,aspects=new Array(_len),_key=0;_key<_len;_key++)aspects[_key]=arguments[_key];return aspects.forEach((function(p){p instanceof WeaverProfile?Object.values(p._aspectsRegistry).forEach((function(p){return _this.enable(p)})):_this.setEnabled(p,!0)})),this}},{key:"disable",value:function(){for(var _this2=this,_len2=arguments.length,aspects=new Array(_len2),_key2=0;_key2<_len2;_key2++)aspects[_key2]=arguments[_key2];return aspects.forEach((function(p){p instanceof WeaverProfile?Object.values(p._aspectsRegistry).forEach((function(p){return _this2.disable(p)})):utils.isObject(p)?_this2.setEnabled(p,!1):(utils.assert(utils.isString(p)),delete _this2._aspectsRegistry[p])})),this}},{key:"reset",value:function(){return this._aspectsRegistry={},this}},{key:"setEnabled",value:function(aspect,enabled){var _a,id=utils.getAspectOptions(aspect).id;if(enabled){var oldAspect=this._aspectsRegistry[id];oldAspect&&oldAspect!==aspect&&console.warn("Aspect ".concat(aspect.constructor.name,' overrides aspect "').concat(null!==(_a=null==oldAspect?void 0:oldAspect.constructor.name)&&void 0!==_a?_a:"unknown",'" already registered for name ').concat(id)),this._aspectsRegistry[id]=aspect}else delete this._aspectsRegistry[id];return this}},{key:"getAspect",value:function(aspect){return utils.isString(aspect)?this._aspectsRegistry[aspect]:this._aspectsRegistry[utils.getAspectOptions(aspect).id]}},{key:"getAspects",value:function(){return Object.values(this._aspectsRegistry)}},{key:Symbol.iterator,value:function(){var aspects=this.getAspects(),i=0;return{next:function(){return i>=aspects.length?{value:void 0,done:!0}:{value:aspects[i++],done:!1}}}}}]),WeaverProfile}();function _getWeaverContext(){return _weaverContext}var _AdviceFactory=function(){function _AdviceFactory(){_classCallCheck(this,_AdviceFactory)}return _createClass(_AdviceFactory,null,[{key:"create",value:function(pointcut,target){var _a;utils.assert(!(pointcut.type===exports.AnnotationType.PROPERTY)||pointcut.ref.startsWith("property#get")||pointcut.ref.startsWith("property#set"));var _advice,_ref=[target.proto,target.propertyKey],aspect=_ref[0],propertyKey=_ref[1];if(utils.assert(utils.isFunction(aspect[propertyKey])),(_advice=pointcut.phase===exports.PointcutPhase.COMPILE?function(){var a=_advice;_advice=function(){throw new WeavingError("".concat(a," already applied"))};for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return aspect[propertyKey].apply(this,args)}:function(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];return aspect[propertyKey].apply(this,args)}).pointcut=pointcut,_advice.aspect=aspect,Reflect.defineProperty(_advice,Symbol.toPrimitive,{value:function(){return"@".concat(pointcut.phase,"(").concat(pointcut.annotation,") ").concat(aspect.constructor.name,".").concat(String(propertyKey),"()")}}),Reflect.defineProperty(_advice,"name",{value:propertyKey}),pointcut.phase===exports.PointcutPhase.COMPILE&&pointcut.ref.startsWith("property#set"))throw new AdviceError(_advice,"Advice cannot be applied on property setter");if(!_getWeaverContext())throw new Error("Cannot create aspect ".concat(null!==(_a=utils.getProto(aspect).constructor.name)&&void 0!==_a?_a:"",' before "setWeaverContext()" has been called'));return _advice}}]),_AdviceFactory}(),AnnotationContext=function(_AnnotationRef){_inherits(AnnotationContext,_AnnotationRef);var _super=_createSuper(AnnotationContext);function AnnotationContext(){return _classCallCheck(this,AnnotationContext),_super.apply(this,arguments)}return AnnotationContext}(AnnotationRef),AnnotationRegistry=function(){function AnnotationRegistry(_bundleRegistry){_classCallCheck(this,AnnotationRegistry),this._bundleRegistry=_bundleRegistry}return _createClass(AnnotationRegistry,[{key:"register",value:function(context){var byTargetReg=utils.locator(this._bundleRegistry.byTargetClassRef).at(context.target.declaringClass.ref).orElseCompute((function(){return{byAnnotation:{},all:[]}}));[byTargetReg,this._bundleRegistry].forEach((function(reg){utils.locator(reg.byAnnotation).at(context.ref).orElseCompute((function(){return[]})).push(context)})),byTargetReg.all.push(context)}}]),AnnotationRegistry}(),_globalTargetId=0,AnnotationTargetFactory=function(){function AnnotationTargetFactory(){var _this$_TARGET_GENERAT,_this$_REF_GENERATORS,_this=this;_classCallCheck(this,AnnotationTargetFactory),this._TARGET_GENERATORS=(_defineProperty(_this$_TARGET_GENERAT={},exports.AnnotationType.CLASS,_createClassAnnotationTarget),_defineProperty(_this$_TARGET_GENERAT,exports.AnnotationType.PROPERTY,_createPropertyAnnotationTarget),_defineProperty(_this$_TARGET_GENERAT,exports.AnnotationType.METHOD,_createMethodAnnotationTarget),_defineProperty(_this$_TARGET_GENERAT,exports.AnnotationType.PARAMETER,_createParameterAnnotationTarget),_this$_TARGET_GENERAT),this._REF_GENERATORS=(_defineProperty(_this$_REF_GENERATORS={},exports.AnnotationType.CLASS,(function(d){var ref="c[".concat(utils._getReferenceConstructor(d.proto).name,"]");return"".concat(ref,"#").concat(utils.getOrComputeMetadata("aspectjs.targetId",d.proto,(function(){return _globalTargetId++})))})),_defineProperty(_this$_REF_GENERATORS,exports.AnnotationType.PROPERTY,(function(d){return"".concat(_this._REF_GENERATORS[exports.AnnotationType.CLASS](d),".p[").concat(d.propertyKey,"]")})),_defineProperty(_this$_REF_GENERATORS,exports.AnnotationType.METHOD,(function(d){return _this._REF_GENERATORS[exports.AnnotationType.PROPERTY](d)})),_defineProperty(_this$_REF_GENERATORS,exports.AnnotationType.PARAMETER,(function(d){return"".concat(_this._REF_GENERATORS[exports.AnnotationType.METHOD](d),".a[").concat(isNaN(d.parameterIndex)?"*":d.parameterIndex,"]")})),_this$_REF_GENERATORS)}return _createClass(AnnotationTargetFactory,[{key:"of",value:function(args){var target=args[0],propertyKey=utils.isUndefined(args[1])?void 0:String(args[1]),parameterIndex=utils.isNumber(args[2])?args[2]:void 0,atarget={proto:utils.getProto(target),propertyKey:propertyKey,parameterIndex:parameterIndex,descriptor:utils.isObject(args[2])?args[2]:void 0};return this.create(atarget)}},{key:"create",value:function(target,type){var _this2=this;type=utils.isUndefined(type)&&utils.isUndefined(target.type)?utils.isNumber(target.parameterIndex)?exports.AnnotationType.PARAMETER:utils.isUndefined(target.propertyKey)?exports.AnnotationType.CLASS:utils.isObject(target.descriptor)&&utils.isFunction(target.descriptor.value)?exports.AnnotationType.METHOD:exports.AnnotationType.PROPERTY:null!=type?type:target.type;var ref=this._REF_GENERATORS[type](target);return target.type=type,utils.getOrComputeMetadata(function(ref){return"Decorizer.target:".concat(ref)}(ref),target.proto,(function(){var t=_this2._TARGET_GENERATORS[type](_this2,target,_this2._REF_GENERATORS[type]);return Reflect.setPrototypeOf(t,AnnotationTargetImpl.prototype),t}))}}]),AnnotationTargetFactory}();var AnnotationTargetImpl=function(){function AnnotationTargetImpl(){_classCallCheck(this,AnnotationTargetImpl)}return _createClass(AnnotationTargetImpl,[{key:"toString",value:function(){return this.ref}}]),AnnotationTargetImpl}();function _createClassAnnotationTarget(targetFactory,target,refGenerator){var _a;(target=_createAnnotationTarget(target,exports.AnnotationType.CLASS,["proto"],refGenerator)).label='class "'.concat(target.proto.constructor.name,'"'),target.name=target.proto.constructor.name,target.declaringClass=target,target.location=null!==(_a=target.location)&&void 0!==_a?_a:_createLocation(target);var parentClass=_parentClassTargetProperty(targetFactory,target);return Object.defineProperties(target,{parent:parentClass,parentClass:parentClass}),target}function _createMethodAnnotationTarget(targetFactory,target,refGenerator){return(target=_createAnnotationTarget(target,exports.AnnotationType.METHOD,["proto","propertyKey","descriptor"],refGenerator)).label='method "'.concat(target.proto.constructor.name,".").concat(String(target.propertyKey),'"'),target.name=target.propertyKey,Object.defineProperties(target,{declaringClass:_declaringClassTargetProperty(targetFactory,target),parent:_declaringClassTargetProperty(targetFactory,target),parentClass:_parentClassTargetProperty(targetFactory,target)}),target.location||(target.location=utils.locator(_getDeclaringClassLocation(target)).at(target.propertyKey).orElseCompute((function(){return _createLocation(target)})),target.location.args=function(targetFactory,target,refGenerator){var _a;return(target=_createAnnotationTarget(Object.assign(Object.assign({},target),{parameterIndex:NaN}),exports.AnnotationType.PARAMETER,["parameterIndex","proto","propertyKey"],refGenerator)).label='parameter "'.concat(target.proto.constructor.name,".").concat(String(target.propertyKey),'(*)})"'),Object.defineProperties(target,{declaringClass:_declaringClassTargetProperty(targetFactory,target),parent:_declaringMethodTargetProperty(targetFactory,target),parentClass:_parentClassTargetProperty(targetFactory,target)}),target.location=null!==(_a=target.location)&&void 0!==_a?_a:_createLocation(target,[]),target}(targetFactory,target,refGenerator).location),target}function _getDeclaringClassLocation(target){return utils.locator(target.declaringClass).at("location").orElseCompute((function(){return _createLocation(target.declaringClass)}))}function _createPropertyAnnotationTarget(targetFactory,target,refGenerator){var _a;return(target=_createAnnotationTarget(target,exports.AnnotationType.PROPERTY,["proto","propertyKey"],refGenerator)).label='property "'.concat(target.proto.constructor.name,".").concat(String(target.propertyKey),'"'),Object.defineProperties(target,{declaringClass:_declaringClassTargetProperty(targetFactory,target),parent:_declaringClassTargetProperty(targetFactory,target),parentClass:_parentClassTargetProperty(targetFactory,target)}),utils.assert(target.type===exports.AnnotationType.PROPERTY),target.location=null!==(_a=target.location)&&void 0!==_a?_a:utils.locator(_getDeclaringClassLocation(target)).at(target.propertyKey).orElseCompute((function(){return _createLocation(target)})),target}function _createParameterAnnotationTarget(targetFactory,target,refGenerator){if((target=_createAnnotationTarget(target,exports.AnnotationType.PARAMETER,["parameterIndex","proto","propertyKey"],refGenerator)).label='parameter "'.concat(target.proto.constructor.name,".").concat(String(target.propertyKey),"(#").concat(target.parameterIndex,')"'),Object.defineProperties(target,{declaringClass:_declaringClassTargetProperty(targetFactory,target),parent:_declaringMethodTargetProperty(targetFactory,target),parentClass:_parentClassTargetProperty(targetFactory,target)}),!target.location){var methodLocation=utils.locator(_getDeclaringClassLocation(target)).at(target.propertyKey).orElseCompute((function(){return targetFactory.create({proto:target.proto,propertyKey:target.propertyKey,descriptor:Object.getOwnPropertyDescriptor(target.proto,target.propertyKey)},exports.AnnotationType.METHOD).location}));target.location=utils.locator(methodLocation.args).at(target.parameterIndex).orElseCompute((function(){return _createLocation(target)}))}return target.descriptor=Reflect.getOwnPropertyDescriptor(target.proto,target.propertyKey),target}function _createAnnotationTarget(target,type,requiredProperties,refGenerator){var _a;return requiredProperties.forEach((function(n){return utils.assert(!utils.isUndefined(target[n]),"target.".concat(n," is undefined"))})),target=Object.assign({},target),Object.keys(target).filter((function(p){return requiredProperties.indexOf(p)<0})).forEach((function(n){return delete target[n]})),target.type=type,target.ref=null!==(_a=target.ref)&&void 0!==_a?_a:refGenerator(target),target}function _parentClassTargetProperty(targetFactory,dtarget){return{get:function(){var parentProto=Reflect.getPrototypeOf(dtarget.proto);return parentProto===Object.prototype?void 0:targetFactory.of([parentProto])}}}function _declaringClassTargetProperty(targetFactory,dtarget){return{get:function(){return targetFactory.create(Object.assign({},dtarget),exports.AnnotationType.CLASS)}}}function _declaringMethodTargetProperty(targetFactory,dtarget){return{get:function(){return targetFactory.of([dtarget.proto,dtarget.propertyKey])}}}function _createLocation(target){var locationStub=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new AdviceLocationImpl,proto=Object.create(Reflect.getPrototypeOf(locationStub));return proto.getTarget=function(){return target},Reflect.setPrototypeOf(locationStub,proto),locationStub}var _AnnotationType$CLASS,_AnnotationType$PROPE,_AnnotationType$METHO,_AnnotationType$PARAM,_FILTERS,AdviceLocationImpl=function(){function AdviceLocationImpl(){_classCallCheck(this,AdviceLocationImpl)}return _createClass(AdviceLocationImpl,[{key:"getTarget",value:function(){throw new Error("No target registered")}}]),AdviceLocationImpl}(),AnnotationLocationFactory=function(){function AnnotationLocationFactory(_targetFactory){_classCallCheck(this,AnnotationLocationFactory),this._targetFactory=_targetFactory}return _createClass(AnnotationLocationFactory,[{key:"of",value:function(obj){var proto=utils.getProto(obj);if(proto===Object.prototype)throw new Error("given object is neither a constructor nor a class instance");return this._targetFactory.create({proto:proto,type:exports.AnnotationType.CLASS}).declaringClass.location}}],[{key:"getTarget",value:function(location){if(location)return Object.getPrototypeOf(location).getTarget()}}]),AnnotationLocationFactory}(),RootAnnotationsBundle=function(){function RootAnnotationsBundle(_registry){_classCallCheck(this,RootAnnotationsBundle),this._registry=_registry}return _createClass(RootAnnotationsBundle,[{key:"at",value:function(location){var searchParents=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new ClassAnnotationsBundle(this._registry,location,searchParents)}},{key:"all",value:function(){for(var _len=arguments.length,annotations=new Array(_len),_key=0;_key<_len;_key++)annotations[_key]=arguments[_key];if(annotations&&1===annotations.length)return utils.locator(this._registry.byAnnotation).at(getAnnotationRef(annotations[0])).orElseGet((function(){return[]}));var entries=Object.entries(this._registry.byAnnotation);if(annotations&&annotations.length){var annotationsSet=new Set(annotations.map((function(a){return getAnnotationRef(a)})));entries=entries.filter((function(e){return annotationsSet.has(e[0])}))}return entries.map((function(e){return e[1]})).flat()}}]),RootAnnotationsBundle}(),ClassAnnotationsBundle=function(_RootAnnotationsBundl){_inherits(ClassAnnotationsBundle,_RootAnnotationsBundl);var _super=_createSuper(ClassAnnotationsBundle);function ClassAnnotationsBundle(registry,location,searchParents){var _this;return _classCallCheck(this,ClassAnnotationsBundle),(_this=_super.call(this,registry)).searchParents=searchParents,_this._target=AnnotationLocationFactory.getTarget(location),_this}return _createClass(ClassAnnotationsBundle,[{key:"all",value:function(){for(var _len2=arguments.length,annotations=new Array(_len2),_key2=0;_key2<_len2;_key2++)annotations[_key2]=arguments[_key2];return this._allWithFilter(this._target,"all",annotations)}},{key:"onClass",value:function(){for(var _len3=arguments.length,annotations=new Array(_len3),_key3=0;_key3<_len3;_key3++)annotations[_key3]=arguments[_key3];return this._allWithFilter(this._target,exports.AnnotationType.CLASS,annotations)}},{key:"onSelf",value:function(){for(var _len4=arguments.length,annotations=new Array(_len4),_key4=0;_key4<_len4;_key4++)annotations[_key4]=arguments[_key4];return this._allWithFilter(this._target,this._target.type,annotations)}},{key:"onProperty",value:function(){for(var _len5=arguments.length,annotations=new Array(_len5),_key5=0;_key5<_len5;_key5++)annotations[_key5]=arguments[_key5];return this._allWithFilter(this._target,exports.AnnotationType.PROPERTY,annotations)}},{key:"onMethod",value:function(){for(var _len6=arguments.length,annotations=new Array(_len6),_key6=0;_key6<_len6;_key6++)annotations[_key6]=arguments[_key6];return this._allWithFilter(this._target,exports.AnnotationType.METHOD,annotations)}},{key:"onParameter",value:function(){for(var _len7=arguments.length,annotations=new Array(_len7),_key7=0;_key7<_len7;_key7++)annotations[_key7]=arguments[_key7];return this._allWithFilter(this._target,exports.AnnotationType.PARAMETER,annotations)}},{key:"_allWithFilter",value:function(target,filter,annotations){if(!target)return[];var parentContext=target.parentClass&&this.searchParents?this._allWithFilter(target.parentClass,filter,annotations):[],reg=utils.locator(this._registry.byTargetClassRef).at(target.declaringClass.ref).get();if(!reg)return parentContext;var annotationsRef=(null!=annotations?annotations:[]).map(getAnnotationRef),contexts=reg.all;return annotationsRef.length&&(contexts=annotationsRef.map((function(annotationRef){return utils.locator(reg.byAnnotation).at(annotationRef).orElseGet((function(){return[]}))})).flat()),contexts=contexts.filter((function(a){return FILTERS[target.type][filter](target,a)})),[].concat(_toConsumableArray(parentContext),_toConsumableArray(contexts))}}]),ClassAnnotationsBundle}(RootAnnotationsBundle),falseFilter=function(){return!1},FILTERS=(_defineProperty(_FILTERS={},exports.AnnotationType.CLASS,(_defineProperty(_AnnotationType$CLASS={all:function(target,a){return!0}},exports.AnnotationType.CLASS,(function(target,a){return a.target.type===exports.AnnotationType.CLASS})),_defineProperty(_AnnotationType$CLASS,exports.AnnotationType.PROPERTY,(function(target,a){return a.target.type===exports.AnnotationType.PROPERTY})),_defineProperty(_AnnotationType$CLASS,exports.AnnotationType.METHOD,(function(target,a){return a.target.type===exports.AnnotationType.METHOD})),_defineProperty(_AnnotationType$CLASS,exports.AnnotationType.PARAMETER,(function(target,a){return a.target.type===exports.AnnotationType.PARAMETER})),_AnnotationType$CLASS)),_defineProperty(_FILTERS,exports.AnnotationType.PROPERTY,(_defineProperty(_AnnotationType$PROPE={all:function(target,a){return target.propertyKey===a.target.propertyKey}},exports.AnnotationType.CLASS,falseFilter),_defineProperty(_AnnotationType$PROPE,exports.AnnotationType.PROPERTY,(function(target,a){return FILTERS[target.type].all(target,a)})),_defineProperty(_AnnotationType$PROPE,exports.AnnotationType.METHOD,falseFilter),_defineProperty(_AnnotationType$PROPE,exports.AnnotationType.PARAMETER,falseFilter),_AnnotationType$PROPE)),_defineProperty(_FILTERS,exports.AnnotationType.METHOD,(_defineProperty(_AnnotationType$METHO={all:function(target,a){var aTarget=a.target;return target.propertyKey===aTarget.propertyKey&&(aTarget.type===exports.AnnotationType.PARAMETER||aTarget.type===exports.AnnotationType.METHOD)}},exports.AnnotationType.CLASS,falseFilter),_defineProperty(_AnnotationType$METHO,exports.AnnotationType.PROPERTY,falseFilter),_defineProperty(_AnnotationType$METHO,exports.AnnotationType.METHOD,(function(target,a){return a.target.type===exports.AnnotationType.METHOD&&target.propertyKey===a.target.propertyKey})),_defineProperty(_AnnotationType$METHO,exports.AnnotationType.PARAMETER,(function(target,a){return a.target.type===exports.AnnotationType.PARAMETER&&target.propertyKey===a.target.propertyKey})),_AnnotationType$METHO)),_defineProperty(_FILTERS,exports.AnnotationType.PARAMETER,(_defineProperty(_AnnotationType$PARAM={all:function(target,a){var aTarget=a.target;return target.propertyKey===aTarget.propertyKey&&aTarget.type===exports.AnnotationType.PARAMETER&&(isNaN(target.parameterIndex)||target.parameterIndex===aTarget.parameterIndex)}},exports.AnnotationType.CLASS,falseFilter),_defineProperty(_AnnotationType$PARAM,exports.AnnotationType.PROPERTY,falseFilter),_defineProperty(_AnnotationType$PARAM,exports.AnnotationType.METHOD,falseFilter),_defineProperty(_AnnotationType$PARAM,exports.AnnotationType.PARAMETER,(function(target,a){return FILTERS[target.type].all(target,a)})),_AnnotationType$PARAM)),_FILTERS);function getAnnotationRef(annotation){return utils.isString(annotation)?annotation:null==annotation?void 0:annotation.ref}var generatedId=0,AnnotationFactory=function(){function AnnotationFactory(groupId){_classCallCheck(this,AnnotationFactory),this._groupId=groupId}return _createClass(AnnotationFactory,[{key:"create",value:function(name,annotationStub){var groupId=this._groupId;utils.isFunction(name)&&(name=(annotationStub=name).name),annotationStub||(annotationStub=function(){}),name||(name="anonymousAnnotation#".concat(generatedId++));var annotation=function(name,groupId,annotationStub,fn){utils.assert("function"==typeof fn),annotationStub=null!=annotationStub?annotationStub:function(){};var annotationRef=new AnnotationRef(groupId,name),annotation=fn;return Object.defineProperties(annotation,Object.getOwnPropertyDescriptors(annotationStub)),Object.defineProperties(annotation,Object.getOwnPropertyDescriptors(annotationRef)),utils.assert(Object.getOwnPropertySymbols(annotation).indexOf(Symbol.toPrimitive)>=0),annotation}(name,groupId,annotationStub,(function(){for(var _len=arguments.length,annotationArgs=new Array(_len),_key=0;_key<_len;_key++)annotationArgs[_key]=arguments[_key];return _createBootstrapDecorator(annotation,annotationStub,annotationArgs)}));return annotation}}]),AnnotationFactory}();function _createBootstrapDecorator(annotation,annotationStub,annotationArgs){return function(){for(var _a,_b,_len2=arguments.length,targetArgs=new Array(_len2),_key2=0;_key2<_len2;_key2++)targetArgs[_key2]=arguments[_key2];null===(_a=annotationStub.apply(void 0,_toConsumableArray(annotationArgs)))||void 0===_a||_a.apply(null,targetArgs);var weaverContext=_getWeaverContext();if(!weaverContext)throw new Error("Cannot invoke annotation ".concat(null!==(_b=annotation.name)&&void 0!==_b?_b:"",' before "setWeaverContext()" has been called'));var target=_getWeaverContext().annotations.targetFactory.of(targetArgs),annotationContext=new AnnotationContextImpl(target,annotationArgs,annotation);weaverContext.annotations.registry.register(annotationContext);var enhanced=weaverContext.getWeaver().enhance(target);return target.type===exports.AnnotationType.CLASS&&Object.defineProperties(enhanced,Object.getOwnPropertyDescriptors(targetArgs[0])),enhanced}}var AnnotationContextImpl=function(_AnnotationContext){_inherits(AnnotationContextImpl,_AnnotationContext);var _super=_createSuper(AnnotationContextImpl);function AnnotationContextImpl(target,args,annotation){var _this;return _classCallCheck(this,AnnotationContextImpl),(_this=_super.call(this,annotation.groupId,annotation.name)).target=target,_this.args=args,_this}return AnnotationContextImpl}(AnnotationContext),ASPECTJS_ANNOTATION_FACTORY=new AnnotationFactory("aspectjs");exports.ASPECTJS_ANNOTATION_FACTORY=ASPECTJS_ANNOTATION_FACTORY,exports.AdviceError=AdviceError,exports.AdviceType=exports.AnnotationType,exports.AnnotationContext=AnnotationContext,exports.AnnotationFactory=AnnotationFactory,exports.AnnotationLocationFactory=AnnotationLocationFactory,exports.AnnotationPointcutExpressionBuilder=AnnotationPointcutExpressionBuilder,exports.AnnotationRef=AnnotationRef,exports.AnnotationRegistry=AnnotationRegistry,exports.AnnotationTargetFactory=AnnotationTargetFactory,exports.AspectError=AspectError,exports.ClassAnnotationsBundle=ClassAnnotationsBundle,exports.PointcutExpression=PointcutExpression,exports.PropertyAnnotationPointcutExpressionBuilder=PropertyAnnotationPointcutExpressionBuilder,exports.RootAnnotationsBundle=RootAnnotationsBundle,exports.WeaverProfile=WeaverProfile,exports.WeavingError=WeavingError,exports._AdviceFactory=_AdviceFactory,exports._JoinpointFactory=_JoinpointFactory,exports._getWeaverContext=_getWeaverContext,exports._setWeaverContext=function(weaverContext){_weaverContext=weaverContext},exports.on=on}));
//# sourceMappingURL=commons.umd.min.js.map
