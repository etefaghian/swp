{"version":3,"file":"profile.js","sources":["../../../../../commons/src/weaver/profile.ts"],"sourcesContent":["import { getAspectOptions, assert, isObject, isString } from '@aspectjs/core/utils';\nimport { AspectType } from '../aspect';\n\n/**\n * A WeaverProfile is a set of Aspects that can be enabled or disabled.\n * The profile itself is meant to be enabled on a Weaver, making it easy to enable multiples aspects at once.\n * @public\n */\nexport class WeaverProfile {\n    protected _aspectsRegistry: {\n        [aspectId: string]: AspectType;\n    } = {};\n\n    constructor() {}\n    enable(...aspects: (AspectType | WeaverProfile)[]): this {\n        aspects.forEach((p) => {\n            if (p instanceof WeaverProfile) {\n                Object.values(p._aspectsRegistry).forEach((p) => this.enable(p));\n            } else {\n                this.setEnabled(p, true);\n            }\n        });\n        return this;\n    }\n    disable(...aspects: (AspectType | string | WeaverProfile)[]): this {\n        aspects.forEach((p) => {\n            if (p instanceof WeaverProfile) {\n                // disable profile\n                Object.values(p._aspectsRegistry).forEach((p) => this.disable(p));\n            } else if (isObject(p)) {\n                // disable aspect\n                this.setEnabled(p, false);\n            } else {\n                assert(isString(p));\n                // delete aspect by id\n                delete this._aspectsRegistry[p];\n            }\n        });\n        return this;\n    }\n    reset(): this {\n        this._aspectsRegistry = {};\n        return this;\n    }\n    setEnabled(aspect: AspectType, enabled: boolean): this {\n        const id = getAspectOptions(aspect).id;\n        if (enabled) {\n            // avoid enabling an aspect twice\n            const oldAspect = this._aspectsRegistry[id];\n            if (oldAspect && oldAspect !== aspect) {\n                console.warn(\n                    `Aspect ${aspect.constructor.name} overrides aspect \"${\n                        oldAspect?.constructor.name ?? 'unknown'\n                    }\" already registered for name ${id}`,\n                );\n            }\n\n            this._aspectsRegistry[id] = aspect;\n        } else {\n            delete this._aspectsRegistry[id];\n        }\n\n        return this;\n    }\n    getAspect<T extends AspectType>(aspect: string | (new () => T)): T | undefined {\n        if (isString(aspect)) {\n            return this._aspectsRegistry[aspect] as T;\n        } else {\n            return this._aspectsRegistry[getAspectOptions(aspect).id] as T;\n        }\n    }\n\n    getAspects<T extends AspectType>(): AspectType[] {\n        return Object.values(this._aspectsRegistry);\n    }\n\n    [Symbol.iterator](): Iterator<AspectType> {\n        const aspects = this.getAspects();\n        let i = 0;\n        return {\n            next: () => {\n                if (i >= aspects.length) {\n                    return { value: undefined, done: true };\n                }\n                return { value: aspects[i++], done: false };\n            },\n        };\n    }\n}\n"],"names":[],"mappings":"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"}